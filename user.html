<!DOCTYPE html>
<html lang="en">

  <head>
  	<meta charset="utf-8" />
  	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>MorTeam</title>
  	<link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
  	<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  	<link href='http://fonts.googleapis.com/css?family=Exo+2:400,300,200' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <link href="jbox/jBox.css" rel="stylesheet">
    <script type="text/javascript">
    if(localStorage.userToken == undefined){
      location="login";
    }
    </script>
  </head>
  <body>
      <div id="audio-files" style="display: none;">
          <audio id="click-sound">
              <source src="jbox/audio/bling2.wav" type="audio/wav" />
          </audio>
      </div>
    <!-- NAVIGATION BAR -->
    <div class="nav_dropdown">
      <p onclick="location='index'">Home</p>
      <p onclick="location='chat'">Chat</p>
      <p onclick="location='drive'">Drive</p>
      <p onclick="location='cal'">Calendar</p>
      <p onclick="location='networks'">Networks</p>
    </div>
    <div class="navigation_bar">
        <ul id="navbar_list">
          <li class="navbar_item navbar_title" onclick="location='index'">
              MorTeam
          </li>
          <li class="navbar_item searchbox_list_item">
              <input type="text" placeholder="search" class="searchbox"></input>
          </li>
          <li class="navbar_item glyph_link chat_btn menu_btn" onclick="location='chat'">
              <span class="glyphicon glyphicon-comment"></span>
          </li>
          <li class="navbar_item glyph_link drive_btn menu_btn" onclick="location='drive'">
              <span class="glyphicon glyphicon-hdd"></span>
          </li>
          <li class="navbar_item glyph_link cal_btn menu_btn" onclick="location='cal'">
              <span class="glyphicon glyphicon-calendar"></span>
          </li>
          <li class="navbar_item glyph_link networks_btn menu_btn" onclick="location='networks'">
              <span class="glyphicon glyphicon-globe"></span>
          </li>
          <div class="navbar_item right_links">
            <li class="navbar_item glyph_link menu">
                <span class="glyphicon glyphicon-menu-hamburger"></span>
            </li>
            <li class="navbar_item glyph_link" id="notif_button">
                <span class="glyphicon glyphicon-inbox"></span>
            </li>
            <img class="profile_id" id="small_prof_pic" src="./images/user.jpg"></img>
            <span class="profile_name" id="name_link"></span>
          </div>
        </ul>
    </div>
    <div id="notif_drop" class="hidden">
      <ul>
        <li class="notif_list_item">hey</li>
        <li class="notif_list_item">hi</li>
        <li class="notif_list_item">ho</li>
      </ul>
    </div>
    <div id="prof_drop" class="hidden">
      <ul>
        <li class="notif_list_item" onclick="location='user?user='+localStorage.username;">View Profile and Settings</li>
        <li class="notif_list_item" id="logout_button">Log Out</li>
      </ul>
    </div>
    <div id="darken" class="hidden"></div>
    <!-- END OF NAVIGATION BAR -->

    <!-- BODY -->
    <div class="wrapper container-fluid"> <!-- class="profother_wrapper" also -->
      <!-- <div class="user_actions">
        <div class="user_action_btns">
          <input type="button" value="Message" class="message_user user_action button"></input>
          <input type="button" value="Assign Task" class="assign_task_user user_action button"></input>
          <input type="button" value="Change Position" class="change_position_user user_action button"></input>
          <input type="button" value="View Attendance" class="view_attendance_user user_action button"></input>
        </div>
      </div> -->
      <div class="row">
        <div class="col-md-6">
          <div class="attendance_data">
            <span class="data_title bold">Attendance</span><br/>
            <span class="data_point">Number of absences:</span><span class="data_answer">1</span><br/>
            <span class="data_point">Presence percentage:</span><span class="data_answer">89%</span><br/>
            <hr class="hr_small_margin">
            <span class="data_point">Dates of absences:</span><br/>
            <div class="absences_list_scroll">
              <ul class="data_list absences_list">

              </ul>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="tasks_data">
            <span class="data_title bold">Pending Tasks</span>
            <ul class="task_list">
              <li class="data_point">Cut part</li>
              <li class="data_point">Send form to SC</li>
              <li class="data_point">Clean out vacuum cleaner</li>
            </ul>
            <hr class="hr_small_margin">
            <span class="data_title bold">Completed Tasks</span>
            <ul class="task_list">
              <li class="data_point">Screw in talons</li>
              <li class="data_point">Buy wood for tests</li>
              <li class="data_point">Destroy Gabe</li>
              <li class="data_point">Cut part</li>
              <li class="data_point">Send form to SC</li>
              <li class="data_point">Clean out vacuum cleaner</li>
              <li class="data_point">Cut part</li>
              <li class="data_point">Send form to SC</li>
              <li class="data_point">Clean out vacuum cleaner</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- END OF BODY -->

    <!-- LEFTBAR -->
    <div class="leftbar">
      <img class="profile_pic" src="images/user.jpg"></img>
      <div class="leftbar_item" id="leftbar_name">Other Userson</div>
      <!-- <div class="leftbar_item" id="leftbar_title">Vice President of Programming</div> -->
      <div class="leftbar_item"><span id="leftbar_email">otheruserson@gmail.com</span></div>
      <div class="leftbar_item"><span id="leftbar_phone">(310) 828-1224</span></div>
      <div class="others_only">
        <div class="leftbar_item"><input id="message_user" type="button" class="button leader_action" value="Message"></input></div>
        <div class="leftbar_item"><input id="assign_task" type="button" class="button leader_action" value="Assign Task"></input></div>
      </div>
      <!-- <div class="leftbar_item"><input id="change_position" type="button" class="button leader_action" value="Change Position"></input></div> -->
      <div class="change_position_div">
        <div class=" change_position_dropdown_btn btn-group hidden">
            <button class="button dropdown-toggle change_position" data-toggle="dropdown"><span class="position_selection">Member</span>
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu position_drop">
                <li id="position_member" class="position_item selected">Member</li>
                <li id="position_leader" class="position_item">Leader</li>
                <li id="position_admin" class="position_item">Admin</li>
            </ul>
        </div>
      </div>
    </div>
    <!-- END OF LEFTBAR -->
    <script src="jbox/jBox.min.js"></script>
    <script type="text/javascript" src="js/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/velocity.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript">
    function getUserInfo(username){
        request("POST", "/f/getuserinfo", JSON.stringify({"user":localStorage.username, "desiredUser":username}), function(responseText){
            var user = JSON.parse(responseText)[0];
            $("#leftbar_email").html(user.email);
            $("#leftbar_phone").html("("+user.phone.substring(0,3)+") "+user.phone.substring(3,6)+"-"+user.phone.substring(6,10));
            $("#leftbar_name").html(user.first + " " + user.last);
            $(".profile_pic").attr("src", "/f/getPic?user="+username);
            $(".profile_pic").attr("onError", "this.src=\'./images/user.jpg\'");
        });
    }
    function loadAbsences(username){
        request("POST", "/f/getuserabsences", JSON.stringify({"user":localStorage.username, "desiredUser":username}), function(responseText){
            var events = JSON.parse(responseText);
            for (var i = 0; i < events.length; i++){
                $(".absences_list").append('<li class="absence_date">'+ events[i].eventName + " (" + events[i].month + "/" + events[i].day + "/" + events[i].year +')</li>');
            }
        });
    }
      $(window).load(function(){


      });
      $(document).ready(function(){
          if (qs("user") != localStorage.username && (typeof(qs("user")) == "undefined"||qs("user") == ""||typeof(JSON.parse(localStorage.teammates)[qs("user")]) == "undefined")){
              location = "/user?user=" + localStorage.username;
          }
          getUserInfo(qs("user"));
          loadAbsences(qs("user"));
          var viewingUser = qs("user");

        // DISPLAYS PERSONAL INFO IN LEFTBAR
        // getPic(localStorage.username, $(".profile_pic"));
        // $('#leftbar_name').html(localStorage.firstName + " " + localStorage.lastName);
        // // $('#leftbar_title').html("Member of " + localStorage.subdivision);
        // console.log(localStorage.teamNumber + ": " + localStorage.teamName);
        // $('#leftbar_email').html(localStorage.email);
        // $('#leftbar_phone').html("("+localStorage.phone.substring(0,3)+") "+localStorage.phone.substring(3,6)+"-"+localStorage.phone.substring(6,10));

        if( qs("user") == localStorage.username ){
          $(".others_only").replaceWith('<div class="leftbar_item"><input type="button" class="button edit_profile" value="Edit Profile"></input></div><div class="leftbar_item"><input type="button" class="button change_password" value="Change Password"></input></div>')
        }

        var edit_profile_modal = new jBox('Modal', {
            width: 350,
            height: 'auto',
            title: 'Edit Profile',
            onOpen: function() {

            }
        });
        $(document).on("click", ".edit_profile", function(){
          edit_profile_modal.setContent('<input type="text" class="edit_firstname modal_textbox"></input><br/><input type="text" class="edit_lastname modal_textbox"></input><br/><input type="text" class="edit_email modal_textbox"></input><br/><input type="text" class="edit_phone modal_textbox"></input><br/><input type="button" class="button edit_prof_pic modal_button" value="Change Profile Picture"></input><br/><input type="button" class="button modal_button save_prof" value="Save"></input>')
          $(".modal_textbox").val("");
          $(".edit_firstname").val(localStorage.firstName)
          $(".edit_lastname").val(localStorage.lastName)
          $(".edit_email").val(localStorage.email)
          $(".edit_phone").val(localStorage.phone)

          edit_profile_modal.open();
        });

        var change_password_modal = new jBox('Modal', {
            width: 350,
            height: 'auto',
            title: 'Change Password',
            onOpen: function() {

            }
        });
        $(document).on("click", ".change_password", function(){
          change_password_modal.setContent('<input type="password" placeholder="Old password" class="old_password modal_textbox"></input><br/><input type="password" placeholder="New Password" class="new_password modal_textbox"></input><br/><input type="password" placeholder="Confirm New Password" class="new_password_confirm modal_textbox"></input><br/><input type="button" class="button modal_button save_password" value="Save"></input>')
          change_password_modal.open();
        });

        var task_modal = new jBox('Modal', {
            width: 350,
            height: 'auto',
            title: 'Assign Task',
            onOpen: function() {

            }
        });
        $(document).on("click", "#assign_task", function(){
          task_modal.setContent('<input type="text" class="task_name" placeholder="Title"></input><br/><textarea class="task_description" placeholder="Short Description (Optional)"></textarea><br/>Due: <select class="task_month"><option value="1">January</option><option value="2">February</option><option value="3">March</option><option value="4">April</option><option value="5">May</option><option value="6">June</option><option value="7">July</option><option value="8">August</option><option value="9">September</option><option value="10">October</option><option value="11">November</option><option value="12">December</option></select><select class="task_day"></select><select class="task_year"></select><br/><input type="button" class="button submit_task" value="Submit"></input>');

          var thisYear = new Date().getFullYear();
          var thisMonth = new Date().getMonth()+1;
          var thisDay = new Date().getDate();

          $('.task_month option[value="'+thisMonth+'"]').prop('selected',true); //selects current month


          for(var j = thisYear ; j < thisYear+5 ; j++){
            $(".task_year").append("<option value='"+j+"'>"+j+"</option>"); //adds next 5 years
          }

          for(var k = 1 ; k <= new Date($(".task_year").find(":selected").text(), $('.task_month option[value="'+thisMonth+'"]').val(), 0).getDate() ; k++ ){
            $(".task_day").append("<option value='"+k+"'>"+k+"</option>")
            if(k == new Date($(".task_year").find(":selected").text(), $('.task_month option[value="'+thisMonth+'"]').val(), 0).getDate()){
              $(".task_day option[value='"+(parseInt(thisDay)+1).toString()+"']").prop("selected", true);
            }
          }

          $(".task_month").change(function(){
            $(".task_day").empty();
            for(var k = 1 ; k <= new Date($(".task_year").find(":selected").text(), $(".task_month").find(":selected").val(), 0).getDate() ; k++ ){
              $(".task_day").append("<option value='"+k+"'>"+k+"</option>")
            }
          });
          $(".task_year").change(function(){
            $(".task_day").empty();
            for(var i = 1 ; i <= new Date($(this).find(":selected").text(), $(".task_month").find(":selected").val(), 0).getDate() ; i++){
              $(".task_day").append("<option value='"+i+"'>"+i+"</option>");
            }
          })
          task_modal.open();
        })

        setTimeout(function(){
            if (localStorage.position == "Member" || viewingUser == localStorage.username){
                $(".change_position").attr("disabled","true");
            }
            else if (localStorage.position == "Leader"){
                $("#position_admin").hide();
                if (JSON.parse(localStorage.teammates)[viewingUser].position == "Admin"){
                    $(".change_position").attr("disabled","true");
                }
            }
            if (viewingUser == localStorage.username){
                $(".change_position_dropdown_btn").removeClass("hidden");
                $(".position_selection").html(localStorage.position);
            }
            else {
                $(".change_position_dropdown_btn").removeClass("hidden");
                $(".position_selection").html(JSON.parse(localStorage.teammates)[viewingUser].position);
            }
        }, 1000);//FIND BETTER WAY


        $("#message_user").click(function(){

        });
        $("#assign_task").click(function(){

        });
        $("#change_position").click(function(){

        });
        $(document).on("click", ".absence_date", function(){
          // take to calendar
        });
        $(document).on("click", ".position_item", function(){
          $(".position_item").removeClass("selected");
          $(this).addClass("selected");
          $(".position_selection").html( $(this).html() );
          var position = $(this).html();
          request("POST", "/f/updateposition", JSON.stringify({"user":localStorage.username, "userToChange":viewingUser, "userToChangePosition":position, "teamCode":localStorage.teamCode, "token":localStorage.userToken}), function(responseText){
              //success
          });
        });


      });
      window.onunload = function(){};
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-66914799-1', 'auto');
      ga('send', 'pageview');

    </script>

  </body>
</html>
