<!DOCTYPE html>
<html lang="en">

  <head>
  	<meta charset="utf-8" />
  	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Morganizer</title>
  	<link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
  	<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  	<link href='http://fonts.googleapis.com/css?family=Exo+2:400,300,200' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <link href="jbox/jBox.css" rel="stylesheet">
    <link href="jbox/themes/TooltipDark.css" rel="stylesheet">
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <script type="text/javascript">
      if(localStorage.userToken == undefined){
        location="login.html";
      }
    </script>
    <script src="js/spin.js"></script>
    <script type="text/javascript">
      // var loadingImg = new Image();
      // loadingImg.className = "spinner"
      var loadingDiv = document.createElement("div");
      loadingDiv.className = "loading_circle";
      loadingDiv.id = "loading_circle";
      // loadingImg.onload = function(){
      //   loadingDiv.appendChild(loadingImg)
      // }
      // loadingImg.src="images/ajax-loader.gif";
    </script>
  </head>
  <body>
    <!-- NAVIGATION BAR -->
    <div class="navigation_bar">
      <ul id="navbar_list">
        <li class="navbar_item"><input type="text" placeholder="search drive" class="searchbox"></input></li>
        <li class="navbar_item">
          <div id="categories">
           <ul>
            <li class="navbar_item navbar_link" id="home_link" onclick="location='index.html'"><span class="glyphicon glyphicon-home"></span><div class="hborder"></div></li><!--
            --><li class="navbar_item navbar_link" id="chat_link" onclick="location='chat.html'"><span class="glyphicon glyphicon-comment"></span><div class="border"></div></li><!--
            --><li class="navbar_item navbar_link active" id="drive_link" onclick="location='drive.html'"><span class="glyphicon glyphicon-hdd"></span><div class="border"></div></li><!--
            --><li class="navbar_item navbar_link" id="cal_link" onclick="location='cal.html'"><span class="glyphicon glyphicon-calendar"></span><div class="border"></div></li><!--
            --><li class="navbar_item navbar_link" id="settings_link" onclick="location='settings.html'"><span class="glyphicon glyphicon-cog"></span><div class="border"></div></li>
           </ul>
          </div>
        </li>
        <li class="navbar_item" id="notif_button"><span class="glyphicon glyphicon-inbox"></span></li>
        <li class="navbar_item" id="profile_id"><img id="small_prof_pic" src="./images/user.jpg"></img></li>
        <li class="navbar_item" id="profile_name"><span id="name_link"></span></li>
      </ul>
    </div>
    <div class="triangle_thing_notif hidden"></div>
    <div class="triangle_thing_prof hidden"></div>
    <div id="notif_drop" class="hidden">
      <ul>
        <li class="notif_list_item">hey</li>
        <li class="notif_list_item">hi</li>
        <li class="notif_list_item">ho</li>
      </ul>
    </div>
    <div id="prof_drop" class="hidden">
      <ul>
        <li class="notif_list_item" onclick="location='profile.html';">View Profile</li>
        <li class="notif_list_item" id="logout_button">Log Out</li>
      </ul>
    </div>
    <div id="darken" class="hidden"></div>
    <!-- END OF NAVIGATION BAR -->

    <!-- BODY -->
    <div class="container-fluid documents_list hidden">
      <div class="grid">
        <input type="file" id="file" class="hidden" multiple></input>
        <div style="z-index:1;" class="doc_frame add_file">
          <span id="add_file_sign" class="glyphicon glyphicon-plus"></span>
        </div>
        <div style="z-index:1;" class="doc_frame word_doc">
          <div class="hidden confirm_del">
            <p>Are you sure?</p>
            <input type="button" value="yes"></input>
            <input type="button" value="no"></input>
          </div>
          <img src="./images/word.png" class="doc_preview" />
          <span class="doc_title">
            <span class="name">Word Document 1 that has a very long title so that i can see what the overflow looks like</span>
            <span class="file_size">267.7 KB</span>
            <span class="glyphicon glyphicon-trash doc_delete"></span>
          </span>
        </div>
        <div style="z-index:1;" class="doc_frame pdf_doc">
          <div class="hidden confirm_del">
            <p>Are you sure?</p>
            <input type="button" value="yes"></input>
            <input type="button" value="no"></input>
          </div>
          <img src="./images/pdf.png" class="doc_preview" />
          <span class="doc_title">
            <span class="name">PDF Document 1</span>
            <span class="file_size">1.7 MB</span>
            <span class="glyphicon glyphicon-trash doc_delete"></span>
          </span>
        </div>
        <div style="z-index:1;" class="doc_frame excel_doc">
          <div class="hidden confirm_del">
            <p>Are you sure?</p>
            <input type="button" value="yes"></input>
            <input type="button" value="no"></input>
          </div>
          <img src="./images/xc.png" class="doc_preview" />
          <span class="doc_title">
            <span class="name">Excel Spreadsheet 1</span>
            <span class="file_size">2.2 MB</span>
            <span class="glyphicon glyphicon-trash doc_delete"></span>
          </span>
        </div>
        <div style="z-index:1;" class="doc_frame keynote_doc">
          <div class="hidden confirm_del">
            <p>Are you sure?</p>
            <input type="button" value="yes"></input>
            <input type="button" value="no"></input>
          </div>
          <img src="./images/keynote.png" class="doc_preview" />
          <span class="doc_title">
            <span class="name">Powepoint Document 1</span>
            <span class="file_size">5.9 MB</span>
            <span class="glyphicon glyphicon-trash doc_delete"></span>
          </span>        </div>
        <div style="z-index:1;" class="doc_frame default_doc">
          <div class="hidden confirm_del">
            <p>Are you sure?</p>
            <input type="button" value="yes"></input>
            <input type="button" value="no"></input>
          </div>
          <img src="./images/file.png" class="doc_preview" />
          <span class="doc_title">
            <span class="name">Unknown File Type 1</span>
            <span class="file_size">14.7 MB</span>
            <span class="glyphicon glyphicon-trash doc_delete"></span>
          </span>
        </div>
        <div style="z-index:1;" class="doc_frame audio_doc">
          <div class="hidden confirm_del">
            <p>Are you sure?</p>
            <input type="button" value="yes"></input>
            <input type="button" value="no"></input>
          </div>
          <img src="./images/audio.png" class="doc_preview" />
          <span class="doc_title">
            <span class="name">Audio File 1</span>
            <span class="file_size">6.9 MB</span>
            <span class="glyphicon glyphicon-trash doc_delete"></span>
          </span>
        </div>
        <div style="z-index:1;" class="doc_frame image_doc">
          <div class="hidden confirm_del">
            <p>Are you sure?</p>
            <input type="button" value="yes"></input>
            <input type="button" value="no"></input>
          </div>
          <img src="./images/sample1.jpg" class="doc_preview image_preview"/>
          <span class="doc_title">
            <span class="name">Forest Image</span>
            <span class="file_size">7.8 MB</span>
            <span class="glyphicon glyphicon-trash doc_delete"></span>
          </span>
        </div>
        <div style="z-index:1;" class="doc_frame image_doc">
          <div class="hidden confirm_del">
            <p>Are you sure?</p>
            <input type="button" value="yes"></input>
            <input type="button" value="no"></input>
          </div>
          <img src="./images/sample2.jpg" class="doc_preview image_preview"/>
          <span class="doc_title">
            <span class="name">Flower Image</span>
            <span class="file_size">6.3 MB</span>
            <span class="glyphicon glyphicon-trash doc_delete"></span>
          </span>
        </div>
      </div>
    </div>
    <!-- END OF BODY -->

    <!-- LEFTBAR -->
    <div class="leftbar">
      <ul>
        <li class="drive_name drive_options">
          <div class="btn-group">
            <button class="button dropdown-toggle" data-toggle="dropdown">Sort By<span class="caret"></span></button>
            <ul class="dropdown-menu">
              <li class="sort_by">Date</li>
              <li class="sort_by">Name</li>
              <li class="sort_by">Size</li>
              <li class="sort_by">Type</li>
            </ul>
          </div>
        </li>
        <li class="drive_name"><span id="make_drive" class="glyphicon glyphicon-plus"></span>New Folder</li>
        <li class="drive_name"><span id="make_drive" class="glyphicon glyphicon-folder-open"></span>All Files</li>
        <li class="drive_name"><span id="make_drive" class="glyphicon glyphicon-folder-open"></span>Subdivision Files</li>
        <li class="drive_name"><span id="make_drive" class="glyphicon glyphicon-folder-open"></span>Personal Files</li>
        <li class="drive_name"><span id="make_drive" class="glyphicon glyphicon-folder-open"></span>Tagged Files</li>
        <li class="drive_name"><span id="make_drive" class="glyphicon glyphicon-folder-open"></span>Shared Files</li>
      </ul>
    </div>
    <span class="glyphicon glyphicon-chevron-left hide_leftbar"></span>
    <!-- END OF LEFTBAR -->

    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.jquery.com/color/jquery.color-2.1.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	  <script src="js/color-thief.js"></script>
    <script src="jbox/jBox.min.js"></script>
    <script src="js/dropzone.js"></script>
    <script src="js/clamp.min.js"></script>
    <script type="text/javascript" src="js/socket.io.js"></script>
    <script type="text/javascript" src="js/velocity.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.1/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="js/navbar.js"></script>
	  <script type="text/javascript" src="js/hex.js"></script>
    <script type="text/javascript">
		$(document).ready(function(){
      document.body.appendChild(loadingDiv)

      var opts = {
        lines: 13 // The number of lines to draw
      , length: 0 // The length of each line
      , width: 20 // The line thickness
      , radius: 42 // The radius of the inner circle
      , scale: .5 // Scales overall size of the spinner
      , corners: 1 // Corner roundness (0..1)
      , color: 'orange' // #rgb or #rrggbb or array of colors
      , opacity: 0.25 // Opacity of the lines
      , rotate: 0 // The rotation offset
      , direction: 1 // 1: clockwise, -1: counterclockwise
      , speed: 1 // Rounds per second
      , trail: 60 // Afterglow percentage
      , fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
      , zIndex: 2e9 // The z-index (defaults to 2000000000)
      , className: 'spinner' // The CSS class to assign to the spinner
      , top: '50%' // Top position relative to parent
      , left: '50%' // Left position relative to parent
      , shadow: false // Whether to render a shadow
      , hwaccel: false // Whether to use hardware acceleration
      , position: 'absolute' // Element positioning
      }
      var target = loadingDiv
      spinner = new Spinner(opts).spin(target);

      for( i=0 ; i<$('.doc_frame:not(.add_file)').length ; i++){
        $($('.doc_frame:not(.add_file)')[i]).attr("title", $($('.doc_frame:not(.add_file)')[i]).find(".doc_title>span").html());
      }

      $('.doc_frame:not(.add_file)').jBox('Tooltip', {
          delayOpen: 700,
          delayClose: 300,
          theme: "TooltipDark",
          position:  {y: 'bottom'}
      });

			$('.doc_frame:not(.add_file)').click(function(e){
        var a = $(e.target);
        var b = $(this).find(".doc_delete");
        var c = $(this).find("input");
        if(  a[0] != b[0] && a[0] != c[0] && a[0] != c[1]){

          // OPEN OR DOWNLOAD THE DOCUMENT HERE

				  alert( $(this).find(".doc_title>span").html() );  // title of document
        }
			});
      $(".doc_delete").click(function(){
          var frame = $(this).parent().parent();
          frame.unbind("click");
          frame.find(".confirm_del").css("background-color", frame.css("background-color"));
          frame.find(".confirm_del").fadeIn(150).removeClass("hidden");
          $('input[type="button"][value="yes"]').click(function(){
            $grid.isotope('remove', frame).isotope();
          });
          $('input[type="button"][value="no"]').click(function(){
            frame.bind("click", function(e){
              var a = $(e.target);
              var b = $(this).find(".doc_delete");
              var c = $(this).find("input");
              if(  a[0] != b[0] && a[0] != c[0] && a[0] != c[1]){

                // OPEN OR DOWNLOAD THE DOCUMENT HERE

      				  alert( $(this).find(".doc_title>span").html() );  // title of document
              }
      			});
            frame.find(".confirm_del").fadeOut(150);
          });
      });

			$(".doc_frame").mouseenter(function(){
        originalColor = rgb2hex($(this).css("backgroundColor"));
        $(this).css({ backgroundColor: "#"+rgb2hex( $(this).css('backgroundColor') ).darkenHexColorBy(25) })
        $(this).mouseleave(function(){
            $(this).css({ backgroundColor: originalColor })
  			});
			});

      var file_modal = new jBox('Modal', {
          width: 300,
          height: 230,
          attach: $('.add_file'),
          title: 'Upload a File',
          onOpen: function() {
              $(".upload_button").click(function() {
                if(uploads.length == undefined){
                  if(uploads.size > 50000000){
                    alert("file is too big");
                  }else{
                    // upload var uploads
                    var extension = uploads.name.substring(uploads.name.indexOf(".")+1);
                    console.log(extension);
                    console.log(uploads);
                  }
                } else {
                  for( i=0 ; i<uploads.length ; i++){
                    if(uploads[i].size > 50000000){
                      alert("file is too big");
                    }else{
                      // upload var uploads[i]
                      var extension = uploads[i].name.substring(uploads[i].name.indexOf(".")+1);
                      console.log(extension);
                    }
                  }
                }
              });
          }
      });
      var file_modal_content = "<input type='button' class='button file_choose' value='Choose File'></input><p id='chosen_file'>No File Selected</p><input type='text' class='file_name' placeholder='File Name'></input><input type='button' class='button upload_button' value='Upload'></input>"
      file_modal.setContent(file_modal_content);
      $(".file_choose").click(function() {
        $("#file").trigger("click");
      })
      jQuery.fn.flash = function (color, duration) {
         var current = this.css('backgroundColor');
         this.animate({ backgroundColor: color }, duration / 2)
         .animate({ backgroundColor: current }, duration / 2);
      }
      document.getElementById("file").onchange = function () {
        uploads = this.files;
        if(this.files.length == 1){
          document.getElementById("chosen_file").innerHTML = this.files[0].name;
          setTimeout(function(){
            $("#chosen_file").flash("#0099ff", 1000);
          }, 300);
        }else{
          document.getElementById("chosen_file").innerHTML = "Multiple Selected";
          setTimeout(function(){
            $("#chosen_file").flash("#0099ff", 1000);
          }, 300);
        }
      };
      var myDropzone = new Dropzone(".add_file", { url: "#", createImageThumbnails: false, clickable: false, previewTemplate:"<div id='preview-template' style='display: none;''>", uploadMultiple:false});
      myDropzone.on("addedfile", function(file) {
        uploads = file;
        file_modal.open();
        document.getElementById("chosen_file").innerHTML = file.name;
        setTimeout(function(){
          $("#chosen_file").flash("#0099ff", 1000);
        }, 300);
      });
      function showDropHere(){
        $("#add_file_sign").removeClass("glyphicon-plus")
        $("#add_file_sign").html("Drop Here");
        $(".add_file").css("background-color", "#f5f5f5");
        $("#add_file_sign").css("font-size", "40px");
      }
      function hideDropHere(){
        $("#add_file_sign").addClass("glyphicon-plus")
        $("#add_file_sign").html("");
        $(".add_file").css("background-color", "#e9e9e9")
        $("#add_file_sign").css("font-size", "60px");
      }
      $("html").on("dragenter", function(event) {
          event.preventDefault();
          event.stopPropagation();
          showDropHere();
      });
      $("html").on("drop", function(event) {
          event.preventDefault();
          event.stopPropagation();
          hideDropHere();
      });
      $(".add_file").on("drop", function(event) {
          event.preventDefault();
          event.stopPropagation();
          hideDropHere();
      });
      $("html").on("mouseenter", function(event) {
          event.stopPropagation();
          event.preventDefault();
          hideDropHere();
      })
      $("html").on('dragover',function(){
          event.preventDefault();
      });
      $("html").mouseleave(function(){
          hideDropHere();
      });
      var titles = $(".doc_title>span");
      for( i=0 ; i<titles.length ; i++ ){
        $clamp(titles[i], {clamp: 2})
      }
      function hideLeftbar(time, button){
        $(".leftbar").velocity({left: "-260px"}, time);
        $(".documents_list").velocity({left: "40px"}, time);
        $(button).removeClass("glyphicon-chevron-left").addClass("glyphicon-chevron-right");
        $(button).velocity({left: "10px"}, time);
        setTimeout(function(){
          $(".documents_list").css("width", "calc(100vw - 60px)")
          $grid.isotope();
        }, time)
      }
      function showLeftbar(time, button){
        $(".leftbar").velocity({left: "0px"}, time);
        $(".documents_list").velocity({left: "300px"}, time);
        $(button).removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left");
        $(button).velocity({left: "220px"}, time);
        setTimeout(function(){
          $(".documents_list").css("width", "calc(100vw - 320px)")
          $grid.isotope();
        }, time);
      }
      $(".hide_leftbar").click(function(){
        if($(this).hasClass("glyphicon-chevron-left")){
          hideLeftbar(300, this);
        }else{
          showLeftbar(300, this);
        }
      });
      if($(window).width() < 825){
        hideLeftbar(0, ".hide_leftbar");
      }

    });
    function debounce( fn, threshold ) {
      var timeout;
      return function debounced() {
        if ( timeout ) {
          clearTimeout( timeout );
        }
        function delayed() {
          fn();
          timeout = null;
        }
        timeout = setTimeout( delayed, threshold || 100 );
      }
    }
    $(window).load(function(){
      var img = new Array($(".image_preview").length);
      for( var i = 0 ; i<$(".image_preview").length ; i++ ){
        img[i] = document.createElement("img");
        img[i].src = $(".image_preview")[i].src;
        var n = 0
        img[i].onload = function () {
            var colorThief = new ColorThief();
            var color = colorThief.getColor(img[n]);
            $(".image_preview")[n].parentNode.style.backgroundColor = "rgb(" + color + ")";
            var r = color[0];
            var g = color[1];
            var b = color[2];
            var luma = 0.2126 * r + 0.7152 * g + 0.0722 * b;
            if (luma > 170) {
                $($(".image_preview")[n]).next().css( "color", "black" );
            }
            n++;
        };
      }
      spinner.stop();
      $(".documents_list").fadeIn(400).removeClass("hidden");

      var qsRegex;

      $grid = $('.grid').isotope({
        // options
        itemSelector: '.doc_frame',
        layoutMode: 'fitRows',
        transformEnabled: false,
        isAnimated: false,
        filter: function() {
          return qsRegex ? $(this).text().match( qsRegex ) : true;
        },
        getSortData: {
          name: '.name',
          size: function( itemElem ) {
            var size = $( itemElem ).find('.file_size').text();
            if(size.indexOf("MB") > -1){
              size = size.substring(0, size.indexOf("MB") );
              return parseFloat( size.replace( /[\(\)]/g, '') ) * 1000;
            }else{
              return parseFloat( size.replace( /[\(\)]/g, '') );
            }
          },
          type: function( itemElem ) {
            if( $(itemElem).hasClass("add_file") ){
              return "a"
            }else if( $(itemElem).hasClass("word_doc") ){
              return "a";
            }else if( $(itemElem).hasClass("pdf_doc") ){
              return "b";
            }else if( $(itemElem).hasClass("keynote_doc") ){
              return "c";
            }else if( $(itemElem).hasClass("excel_doc") ){
              return "d";
            }else if( $(itemElem).hasClass("audio_doc") ){
              return "e";
            }else if( $(itemElem).hasClass("default_doc") ){
              return "f";
            }else if( $(itemElem).hasClass("image_doc") ){
              return "g";
            }else{
              return "z";
            }
          }
        }

      });

      var $quicksearch = $('.searchbox').keyup( debounce( function() {
        qsRegex = new RegExp( $quicksearch.val(), 'gi' );
        $grid.isotope();
      }, 200 ) );




      var sorts = ["date", "name", "size", "type"];
      if(localStorage.chosenSort != undefined){
        var chosenSort = "";
        $(".sort_by").removeClass("selected");
        $( $(".sort_by")[sorts.indexOf(localStorage.chosenSort)] ).addClass("selected");
        localStorage.chosenSort = $( $(".sort_by")[sorts.indexOf(localStorage.chosenSort)] ).html().toLowerCase();
        if(localStorage.chosenSort === "date"){
          chosenSort = "original-order";
        }else{
          chosenSort = localStorage.chosenSort;
        }
        $grid.isotope({sortBy: chosenSort})
      }

      $(".sort_by").click(function(){
        console.log("sort-by clicked");
        var chosenSort = "";
        $(".sort_by").removeClass("selected");
        $(this).addClass("selected");
        localStorage.chosenSort = $(this).html().toLowerCase();
        if(localStorage.chosenSort === "date"){
          chosenSort = "original-order";
        }else{
          chosenSort = localStorage.chosenSort;
        }
        $grid.isotope({sortBy: chosenSort})
      });




    });
    window.onunload = function(){};
    </script>
  </body>
</html>
